from mws.pipeline import Pipeline
from mws.operators import Max
from mws.sources import IterSource
from mws.sinks import CallbackSink

SOURCE = IterSource(
    [
        15.0,
        22.5,
        20.3,
        18.7,
        25.2,
        30.1,
        35.6,
        40.4,
        45.0,
        10.8,
        5.5,
        0.0,
        -5.2,
        -10.3,
        28.9,
        32.5,
        38.7,
        42.1,
        37.3,
        29.4,
        23.8,
        17.6,
        13.2,
        8.8,
        3.3,
        -2.4,
        -7.1,
        -12.5,
        33.0,
        39.2,
        41.5,
        36.6,
        31.7,
        26.4,
        21.9,
        16.5,
        11.0,
        6.3,
        1.2,
        -3.8,
        -8.6,
        -11.9,
        34.7,
        27.5,
        19.3,
        14.4,
        9.6,
        4.2,
        -1.5,
        -4.9,
        -6.7,
        -9.4,
    ]
)
EXPECTED = [
    15.0,
    22.5,
    22.5,
    22.5,
    25.2,
    30.1,
    35.6,
    40.4,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
    45.0,
]


def test_max_temps() -> None:
    output = []
    sink = CallbackSink(output.append)

    pipeline = Pipeline.of(SOURCE).then(...).then(sink)

    pipeline.start()
    assert output == EXPECTED
